# 可変記事ルールチェックシステム - 実行プロンプト

## 🤖 Claude Code自動実行モード

このプロンプトがREADME.md経由で呼び出された場合：

### 全自動実行手順
1. **対象ファイル名を確認** - ユーザー指定の対象ファイルを特定
2. **4段階順次実行** - 1回目→2回目→3回目→4回目を自動で順次実行
3. **段階完了確認** - 各段階の完了を確認してから次へ進む
4. **最終サマリー出力** - 全4段階完了後、処理結果サマリーを表示

### エラーハンドリング
- **ファイル未発見**: 可変記事フォルダ内を検索し、類似ファイル名を提案
- **処理途中エラー**: 前回の処理結果を確認し、継続可能な段階から再開
- **ルールファイル不足**: 必要なルールファイルの一覧表示と不足ファイルの特定

### 実行完了条件
- 全4段階のファイル生成・更新が完了
- エラーなく処理が完了
- 処理結果サマリーが出力済み

---

## 📋 段階別実行指示

### 1回目

あなたはTSVファイルの項目別分割専門家です。可変ファイルを列読みで項目別に分割してください。

【重要】必ず指定されたルールファイルの形式に従って結果を出力してください。

以下の指示に従ってください：

1. @項目別分割ルール のファイルを1つ1つ丁寧に読む：
   - TSV項目別分割マニュアル.md
   - TSV項目別分割テンプレート.md
   - 項目別分割テンプレート集.md
   - 項目別分割チェックリスト.md

2. 対象ファイルを列読みで解析し、項目別に分割：
   - TSVファイルのヘッダー行（1行目）から項目名を抽出
   - **重要：列位置特定方法**
     * 4行目の「項目」の右の列がライティングスペース
     * 各項目のライティングスペース列位置を正確に特定
   - 各行の要素タイプ（h1見出し、h2中見出し、本文等）を判定
   - 文字数範囲を確認
   - **重要：内容が複数ある場合の処理**
     * 要素タイプ、文字数範囲、内容1、内容2、文字数の順で構成されている場合
     * 内容1は項目名やタイトル
     * 内容2が実際のライティング内容
     * 内容2を抽出して使用すること
   - **注意：空の列やデータの不整合がある場合でも、項目名に基づいて正確な列を特定すること**
   - **重要：要素タイプの制約を理解すること：**
     * 「大見出し」「中見出し」「小見出し」はTOP列のみに存在
     * その他の列には「h1見出し」「h2中見出し」「本文」のみ存在
     * 上記制約に反する要素タイプが抽出された場合は、列位置特定を再確認すること

3. 各項目を項目別分割テンプレート集の構造パターンに従って分割：
   - パターン1（基本構造）: ブログ、コラム、お問い合わせ、よくある質問、代表あいさつ
   - パターン2（中見出し構造）: アクセス、コンセプト、サービス、施術の流れ
   - パターン3（複合構造）: TOP
   - パターン4（非表示）: 求人一覧

4. 各項目を `項目別_[項目名].md` として保存：
   - 出力先: `ルールチェック結果/[対象ファイル名]/項目別分割/`
   - ファイル名: `項目別_TOP.md`、`項目別_アクセス.md` など
   - 内容: 項目別分割テンプレート集の形式に従って作成

【注意事項】
- 列読みで正確に項目を特定してください
- **重要：4行目の「項目」の右の列がライティングスペースであることを理解し、正確な列位置を特定すること**
- **重要：内容が複数ある場合は内容2（実際のライティング内容）を抽出すること**
- 各項目の構造パターンを正しく判定してください
- 文字数範囲を正確に記録してください
- 0文字の項目は「0文字」として記録してください
- **データの不整合や空の列があっても、項目名に基づいた正確な列特定を維持すること**
- **要素タイプ制約の確認：「大見出し」「中見出し」「小見出し」がTOP列以外で抽出された場合は列位置を再特定すること**


### 2回目

あなたは要素別分割専門家です。項目別分割されたファイルを要素別に分割してください。

【重要】この段階ではルールチェックは行いません。純粋に要素別分割のみを実行してください。

以下の指示に従ってください：

1. 各 `項目別_[項目名].md` を読み込み

2. ファイル内容を要素ごとに分解：
   - h1見出し
   - h2中見出し
   - 本文
   - 中見出し
   - 大見出し
   - 小見出し
   - 注釈・リンク

3. 各要素を個別ファイルとして保存：
   - ファイル名: `[項目名]_行[番号]_[要素名]_チェック結果.md`
   - 出力先: `ルールチェック結果/[対象ファイル名]/チェック結果/`
   - **重要：ファイル内容は要素の基本情報のみ記録し、ルールチェック結果は含めない**

4. 各ファイルに記録する内容：
   - チェック対象情報（項目名、要素タイプ、行番号、文字数範囲、実際の文字数）
   - チェック対象テキスト（抽出した文章）
   - **ルールチェック結果は記録しない（3回目で実行）**

【注意事項】
- 各要素の内容を正確に抽出してください
- 行番号を正しく記録してください
- 要素タイプを正確に判定してください
- **重要：要素タイプの制約を理解すること**
  * 「大見出し」「中見出し」「小見出し」はTOP列のみに存在
  * その他の列には「h1見出し」「h2中見出し」「本文」のみ存在
- **項目別分割ファイルから要素を抽出する際は、元のTSVファイルの列位置を正確に参照すること**
- **途中で列がずれないよう、項目名と要素タイプの対応を正確に把握すること**
- **ルールチェックは絶対に行わない。要素の抽出と基本情報の記録のみを行う**



### 3回目

あなたはプロのルールチェッカーです。要素別分割されたファイルを1つずつ辛口評価でルールチェックしてください。ルールチェックが勝手に追記されていますが、ルールに準拠していないので、必ずルール資料を1度読み、全てのファイルを辛口評価でルールチェックをしてください。

1. ルールの確認
①次のルールファイルを丁寧に読むこと：
  @ルール一覧 
  
②薬機法景表法ルールのフォルダを確認し、今回の業種に該当するルールを特定する。  @09_薬機法景表法ルール  
該当カテゴリがない場合は、最も近いカテゴリを選択する。

2. ファイル処理の準備
`ルールチェック結果/[対象ファイル名]/チェック結果/` フォルダ内の各ファイルを1つずつ処理してください。
ファイル名形式：`[項目名]_行[番号]_[要素名]_チェック結果.md`

3. ファイルごとの処理手順
各ファイルを1つずつ開き、以下の手順でルールチェックを実行してください。

手順A: ファイル内容の把握
①ファイル内容から文章を正確に抽出する。
②要素タイプ（h1見出し、h2中見出し、本文等）を確認し記録する。
③文字数制限を確認し記録する。

手順B: ルールチェック実行
①抽出した対象文章に対し、ルール一覧と薬機法・景表法ルールの内容を辛口評価でルールチェック実行する。
②OK/NG判定と詳細な改善提案を記載する。

4. チェック結果の出力
各ファイルにルールチェック結果を追記してください。

5. 文字数カウント方法
各文字を番号付きで表示し、総文字数を明記する。

書式：文字数カウント: [各文字を(文字数目)で表示] →【総文字数: [最後の文字の文字数]字】

文字数カウント: ス(1)タ(2)ッ(3)フ(4)が(5)家(6)族(7)の(8)よ(9)う(10)に(11)寄(12)り(13)添(14)い(15)致(16)し(17)ま(18)す(19)　　→ 【総文字数: 19字】

6. 注意事項
①毎回必ず元ファイルを参照して内容を抽出すること。
②抽出に失敗しても、文章を勝手に生成してはいけない。再読み取りを行うこと。
③チャットには結果を表示せず、ファイル追記のみ行うこと。
④勝手なことをしないこと！！（例：勝手に一括処理を試さず、正確に1ファイルずつ丁寧にチェックを続けてください。）
⑤**重要：要素タイプの制約を理解すること**
  * 「大見出し」「中見出し」「小見出し」はTOP列のみに存在
  * その他の列には「h1見出し」「h2中見出し」「本文」のみ存在



### 4回目

あなたはプロの文章修正専門家です。
3回目チェックの結果を基に、問題のある文章を修正してください。
ルール漏れの可能性があるため、OK判定が出ていたとしても、すべてのファイルを再度ルールチェックしてください。辛口評価でチェックしてください。
新しいファイルは作成せず、既存ファイルに追記のみ行ってください。

修正優先順位
NGワード除去（最重要・全て除去必須）
文字数調整（指定範囲内に収める）
自然な日本語（可能な範囲で最大化）

処理手順
① `ルールチェック結果/[対象ファイル名]/チェック結果/` フォルダ内の各ファイルを1つずつ開き、ファイル内容を取得する。
  ② @ルール一覧  を必ず再度読み、ルールを遵守する。そしてルールチェックの結果を辛口評価でルールチェックして、 **各ファイルの修正結果を同ファイルに順次「追記」**していき、最後のファイルまで追記して完了とする。
※ 新規ファイルの作成は禁止。ファイル名・項目名の変更も禁止。

③ @薬機法・景表法ルール も必ず該当するルールを確認し、辛口評価で文章をルールチェックしてください。

また、出力では修正案の文章を出力したあと、文字数カウント: [各文字を(文字数目)で表示] →【総文字数: [最後の文字の文字数]字】　を行って要素に合った文字数になっているか確認し、治って無ければ再度修正してください。

注意事項
①各ファイルを毎回参照して、実際の文章内容を正確に抽出し、それぞれのファイルに追記すること。
②勝手に文章を作成しない。抽出に失敗した場合は、該当ファイルを再読み取りして正確な内容を取得すること。
③勝手なことをしないこと！！（例：勝手に一括処理を試さず、正確に1ファイルずつ丁寧にチェックを続けてください。）一括チェック禁止。1ファイルずつ丁寧にチェック→修正→ファイルへ追記すること。
④**重要：要素タイプの制約を理解すること**
  * 「大見出し」「中見出し」「小見出し」はTOP列のみに存在
  * その他の列には「h1見出し」「h2中見出し」「本文」のみ存在
