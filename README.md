# AIKIルールシステム - 汎用ルールチェックシステム

## システム概要

このシステムは、ユーザーが指定したWebサイトコンテンツファイルを項目別に分割し、厳格なルールチェックを実施する汎用的なシステムです。プロのルールチェッカーとして、高品質なコンテンツの作成と改善を支援します。

## 対応範囲

### 業種対応
- **全業種対応**: あらゆる業種のWebサイトコンテンツに対応
- **業種別ルール**: 各業種に最適化されたルールを自動適用
- **カスタムルール**: 特殊な業種や要件にも柔軟に対応

### ファイル形式
- Markdownファイル（.md）
- TSVライクなMarkdownファイル
- その他のテキストファイル
- HTMLファイル（変換後）

## プロジェクトの流れ

### フェーズ1: 項目別分割

#### 1.1 項目ごとに分けるルールの読み込み
以下の4つのルールファイルを読み込み、分割ルールを理解：
- `項目別分割テンプレート集.md`
- `TSV項目別分割テンプレート.md`
- `TSV項目別分割マニュアル.md`
- `項目別分割チェックリスト.md`

#### 1.2 ユーザー指定ファイルの分析
- **対象ファイル**: ユーザーが指定したファイル
- **ファイル形式**: Markdownファイル、TSVライクなMarkdownファイルなど
- **業種**: ユーザーが指定した業種（自動判定も可能）

#### 1.3 項目別分割の実行
ユーザー指定ファイルの内容を分析し、以下の手順で項目別分割を実行：
1. **ファイル内容の解析**: ファイル内の見出し、セクション、コンテンツを分析
2. **項目の自動抽出**: 内容に基づいて適切な項目を自動判定
3. **動的分割**: 抽出された項目ごとに個別ファイルを作成
4. **命名規則**: `項目別_[項目名].md`の形式でファイル名を生成

**例**: 
- `項目別_TOP.md`、`項目別_アクセス.md`、`項目別_サービス.md`など



### フェーズ2: ルールチェック

#### 2.1 新ルールファイルの読み込み（最重要）
**ルールチェックの精度を決定する最重要フェーズ**
以下の新ルールファイルを必ず読み込み、全ルールを完全に理解：

**基本ルールファイル**:
- `01_書き方のルール_共通タイトル・h1見出し_可変用.md` - h1見出し、共通タイトル、文字数ルール
- `02_書き方のルール_見出し・本文_可変用.md` - h2中見出し、本文、体言止めルール
- `04_書き方のルール_業種別呼称.md` - 業種別呼称、基本表現ルール

**NGワードルールファイル**:
- `05_NGワード.md` - 基本的なNGワード、表記統一ルール
- `06_NGワード2.md` - 追加NGワード、文法ルール
- `07_NGワード_削除するルール.md` - 削除対象NGワード、誇張表現・保証表現

**3回チェックテンプレート**:
- `08_1回目チェック_文章チェックテンプレート_可変用.md` - 文章構造、文字数チェック
- `09_2回目チェック_NGワードチェックテンプレート_可変用.md` - NGワード、業種別呼称チェック
- `10_3回目チェック_改善案・文字数チェックテンプレート_可変用.md` - 最終調整、完璧文章生成

**ルール漏れ防止の徹底**:
- 全9ファイルの全ルールを1つ1つ丁寧に読み込む
- ルールの相互関係を理解する
- 業種別適用ルールを完全に把握する

#### 2.2 項目別分割ファイルの要素分割
分割された項目別ファイルをさらに要素ごとに分解してルールチェックを実行：

**要素分割の実行**:
- 各項目別ファイル（`項目別_TOP.md`など）を読み込み
- ファイル内容を要素ごと（h1見出し、h2中見出し、本文、リンクテキストなど）に分解
- 各要素を個別ファイルとして保存
- ファイル名: `[項目名]_[要素名]_行[番号]_チェック結果.md`

#### 2.3 3回チェックシステムの実行（漏れゼロを徹底）
要素分割された全ファイルに対して、プロのルールチェッカーとして辛口評価を実施。

**1回目チェック（文章チェック）**:
- 要素別に個別チェック（h1見出し、h2中見出し、本文、中見出し、本文...）
- 文字数カウント詳細（1文字ずつ表示）
- 都道府県ルール判定
- 構造ルール違反の特定
- 業種別呼称ルール違反の特定

**2回目チェック（NGワードチェック）**:
- NGワードファイルを1つ1つ丁寧に読み込み
- チェック結果フォルダ内のファイルを1つずつ最後のファイルまでルールチェック
- 既存の1回目チェック結果に追記する形で最後のファイルまで出力
- NGワードの厳格な検出
- 業種別呼称ルールの適用
- 表記統一ルールの適用
- 体言止めルールの適用
- 誇張表現・保証表現の検出

**3回目チェック（改善案・文字数チェック）**:
- テンプレートを理解してから実行
- チェック結果フォルダ内のファイルを1つずつ最後のファイルまでチェック
- 既存の1回目・2回目チェック結果に追記する形で出力
- 修正ループ（完璧になるまで繰り返し）
- 文章に合うかつ、ルールに則った自然な日本語の表現を使用
- 文字を追加したりして文字数ルールを遵守
- 不自然な表現にならないよう注意して修正
- 最終完璧文章の生成

**ルールチェック漏れ防止システム**:
- 9つのルールファイルの全ルールを網羅的に適用
- 要素別に上から順番にルールチェック（漏れ防止）
- 各要素の種類に応じて最適なルールを自動選択
- 具体的な改善案を提示

#### 2.4 チェック結果の出力
要素分割されたファイルに対して、3回分離チェックの結果を個別ファイルとして出力：
- `[ファイル名]_チェック結果/`フォルダに出力
- ファイル名: `[項目名]_[要素名]_行[番号]_チェック結果.md`
- 各ファイルに1回目→2回目→3回目の結果を追記
- 最終完璧文章を生成

### フェーズ3: システムの完成とテスト

#### 3.1 システムの完成
- **新ルールフォルダ**の全テンプレートが項目別分割対応版に更新完了
- **3回分離チェックシステム**の実装完了
- **項目別分割ルール**との統合完了

#### 3.2 テストと検証
- 実際のファイルでの動作確認
- ルールチェック精度の検証
- 出力品質の確認
- システムの最適化

## ファイル構成

### 入力ファイル
```
ユーザー指定ファイル/
└── [ユーザー指定ファイル名].md (元ファイル)

項目別分割ルール/
├── 項目別分割テンプレート集.md
├── TSV項目別分割テンプレート.md
├── TSV項目別分割マニュアル.md
└── 項目別分割チェックリスト.md

新ルール/
├── 01_書き方のルール_共通タイトル・h1見出し_可変用.md
├── 02_書き方のルール_見出し・本文_可変用.md
├── 04_書き方のルール_業種別呼称.md
├── 05_NGワード.md
├── 06_NGワード2.md
├── 07_NGワード_削除するルール.md
├── 08_1回目チェック_文章チェックテンプレート_可変用.md
├── 09_2回目チェック_NGワードチェックテンプレート_可変用.md
└── 10_3回目チェック_改善案・文字数チェックテンプレート_可変用.md
```

### 出力ファイル
```
[ユーザー指定ファイル名]_項目別分割/
├── 項目別_[抽出された項目1].md
├── 項目別_[抽出された項目2].md
├── 項目別_[抽出された項目3].md
└── ... (ファイル内容に応じて動的に生成)

[ユーザー指定ファイル名]_チェック結果/
├── [項目名]_[要素名]_行[番号]_チェック結果.md
├── [項目名]_[要素名]_行[番号]_チェック結果.md
├── [項目名]_[要素名]_行[番号]_チェック結果.md
└── ... (要素分割に応じて動的に生成)
```

**実際の例**:
```
おぜき接骨院_項目別分割/
├── 項目別_TOP.md
├── 項目別_アクセス.md
├── 項目別_コンセプト.md
├── 項目別_メニュー.md
└── 項目別_お問い合わせ.md

おぜき接骨院_チェック結果/
├── TOP_h1見出し_行1_チェック結果.md
├── TOP_h2中見出し_行1_チェック結果.md
├── TOP_本文_行1_チェック結果.md
├── アクセス_h1見出し_行1_チェック結果.md
├── アクセス_本文_行1_チェック結果.md
├── コンセプト_h1見出し_行1_チェック結果.md
├── コンセプト_本文_行1_チェック結果.md
└── ... (要素分割に応じて動的に生成)
```

**各チェック結果ファイルの内容**:
- **1回目チェック**: 文章構造、文字数チェック、都道府県ルール判定
- **2回目チェック**: NGワード、業種別呼称、表記統一チェック
- **3回目チェック**: 改善案、文字数調整、最終完璧文章生成

## ルールチェックシステムの特徴

### 要素別チェック
ファイル内容に応じて動的に存在する各要素に対して、適切なルールを適用：

#### 主要な要素タイプ
- **h1見出し**: 文字数（20-40文字）、業種名、形式
- **h2中見出し**: 文字数（15-18文字）、句読点禁止
- **本文**: 文字数（140-180文字または170-180文字）、体言止め禁止、一人称禁止、指示語禁止
- **中見出し（h2以外）**: 文字数（15-18文字）、句読点禁止
- **注釈・リンク**: 補足情報やリンクの適切性
- **その他の要素**: ファイル内容に応じて動的に存在する要素

#### 動的ルール適用
- **要素の自動検出**: ファイル内の全要素を自動的に検出
- **要素別ルール選択**: 各要素の種類に応じて最適なルールを自動選択
- **業種別カスタマイズ**: 業種に応じて要素別ルールをカスタマイズ

### 業種別呼称ルール
#### 自動適用システム
- **業種自動判定**: ファイル内容から業種を自動判定
- **ルール自動選択**: 判定された業種に最適なルールを自動適用
- **カスタム対応**: 特殊な業種や要件にも柔軟に対応

### 評価システム
- **A（優秀）**: ルール違反なし
- **B（良好）**: 軽微な違反のみ
- **C（要修正）**: 中程度の違反
- **D（要大幅修正）**: 複数の重大な違反
- **F（不合格）**: 基本的な構造が破綻

### 緊急度判定
- **最高**: 即座に修正が必要
- **高**: 早急に修正が必要
- **中**: 修正が必要
- **低**: 改善の余地あり

## 使用方法

### 1. ファイル指定と業種設定
1. チェック対象のファイルを指定
2. 業種を指定（自動判定も可能）
3. 必要に応じてカスタムルールを追加

### 2. 項目別分割の実行
1. 分割ルールファイルを読み込む
2. 指定ファイルの内容を詳細分析
3. ファイル内容に基づいて項目を自動抽出
4. 抽出された項目ごとに動的に分割実行
5. `[ファイル名]_項目別分割/`フォルダに出力

### 3. 項目別分割ファイルの要素分割
1. 分割された各項目別ファイル（`項目別_TOP.md`など）を読み込み
2. ファイル内容を要素ごと（h1見出し、h2中見出し、本文、リンクテキストなど）に分解
3. 各要素を個別ファイルとして保存
4. ファイル名: `[項目名]_[要素名]_行[番号]_チェック結果.md`

### 4. ルールチェックの実行（3回分離チェックシステム）
1. **新ルールファイルを完全読み込み**（最重要）
   - 基本ルールファイル（01, 02, 04）
   - NGワードルールファイル（05, 06, 07）
   - 3回分離チェックテンプレート（08, 09, 10）
2. 要素分割された各ファイルの要素を動的に検出
3. **1回目チェック（文章チェック）**を実行
   - 要素別に個別チェック（h1見出し、h2中見出し、本文、中見出し、本文...）
   - 文字数カウント詳細（1文字ずつ表示）
   - 都道府県ルール判定
4. **2回目チェック（NGワードチェック）**を実行
   - NGワードファイルを1つ1つ丁寧に読み込み
   - チェック結果フォルダ内のファイルを1つずつ最後のファイルまでルールチェック
   - 既存の1回目チェック結果に追記する形で最後のファイルまで出力
5. **3回目チェック（改善案・文字数チェック）**を実行
   - テンプレートを理解してから実行
   - チェック結果フォルダ内のファイルを1つずつ最後のファイルまでチェック
   - 既存の1回目・2回目チェック結果に追記する形で出力
   - 修正ループ（完璧になるまで繰り返し）
   - 文章に合うかつ、ルールに則った自然な日本語の表現を使用
6. `[ファイル名]_チェック結果/`フォルダに出力

### 5. 結果の確認と修正
1. ルールチェック結果ファイルを確認
2. 改善案に従って修正
3. 必要に応じて再チェックを実行

### 6. カスタマイズ
1. 新しい業種のルール追加
2. 既存ルールの修正
3. テンプレートのカスタマイズ

## 品質保証

### チェック漏れの防止（最重要）
- **新ルールファイル9個の完全読み込み**（漏れ防止の前提）
- ファイル内の全要素を動的に検出
- 検出された要素を上から順番にチェック
- **3回分離チェックシステム**で段階的にチェック
- 各要素ごとに個別にルール適用
- 元の文章を必ず引用
- 要素の種類に関係なく漏れなくチェック
- **ルール違反の見逃しを防ぐため、各要素を上から順番にチェック**

### 改善案の質の確保
- 具体的な修正内容を提示
- 修正理由を明確に説明
- 文字数を再計算

### 評価の適切性
- ルール違反の程度に応じた評価
- 緊急度の適切な判定
- 一貫性のある評価基準

## 注意事項

### ルールの遵守（最重要）
- **新ルールファイル9個の全ルールを厳格に適用**
- ルールの漏れを絶対に許さない
- 例外は認めない
- 一貫性を保つ
- **3回分離チェックシステム**で段階的に品質を向上
- **ルールチェックの精度を最優先に考える**

### 品質の維持
- 辛口評価を心がける
- 具体的な改善案を提示
- 理由を明確に説明

### 継続的改善
- ルールの見直し
- プロセスの改善
- 品質の向上


## 使用例

### 自動業種判定でのチェック
```
入力: 山田葬儀社.md
業種: 自動判定（葬儀社）
項目抽出: TOP、アクセス、サービス、お問い合わせ
出力: 山田葬儀社_項目別分割/, 山田葬儀社_ルールチェック結果/
```

### 手動業種指定でのチェック
```
入力: 田中整体院.md
業種: 整体院（手動指定）
項目抽出: TOP、施術内容、料金、アクセス
出力: 田中整体院_項目別分割/, 田中整体院_ルールチェック結果/
```
